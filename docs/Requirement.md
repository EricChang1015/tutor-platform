# Tutor Platform MVP 說明文件

我是線上教學老師與老闆，旗下有多名老師與學生，目前由我手動媒合上課時間、回收老師回報並結算。此專案目標是做出一個可先上線的 MVP，之後能逐步擴展功能與自動化流程。

## 1) 系統需求（MVP → 可擴展）

核心角色
- Admin：總覽、建立老師/學生、手動配課與加堂、月結審核、批准留言。
- Teacher：設定可授課時段、管理課表、上課連結、課後上傳證明與教師回報、查看月結。
- Student：持有約課次卡、取消約課次卡、課程包、選老師與時段預約、課後填學習目標。

購買項目
顯示在Student用戶的Dashboard
一個table顯示用戶購買的品項, 管理員可以延長或修改過期時間
- 約課次卡: 由管理員授予, 激活後一張卡一周的時間限制, 例如52張卡預設就是52周後到期
- 體驗次卡: 由管理員授予, 其效果等同約課次卡, 激活後一張卡一周的時間限制.
- 補償次卡: 由管理員授予, 其效果等同約課次卡, 激活後一張卡一周的時間限制.
- 取消約課次卡: 每10堂課會給予一張取消約課次卡, 到期時間與約課次卡一致.

顯示範例
| 套餐名稱 | 數量 | 類型 | 購買時間 | 啟動時間 | 過期時間 | 狀態 |
| -------------- | ------- | ---------------- | --------- | --------- | --------- | ---------- |
| 體驗卡 | 0/ 1張 | 新簽體驗課程 | 2021/2/16 | 2021/2/19 | 2023/4/29 | 已啟用 |
| 歐美外教次卡 | 0/ 65張 | 建議升級 | 2021/2/22 | 2021/2/22 | 2022/5/23 | 已啟用 |
| 菲律賓外籍教師次卡 | 0/ 65 張 | 建議升級 | 2021/2/22 | 2021/2/22 | 2022/5/23 | 已啟用 |
| 歐美外教次卡 | 1/ 2張 | feedback課程補償 | 2022/5/23 | 2025/9/17 | 2025/10/1 | 已啟動 |
| 專業中教次卡 | 0/ 2張 | feedback課程補償 | 2025/9/30 | | 14天 | 啟動(按鈕) |

Note: 
- 目前僅有菲律賓老師, 因此僅顯示"約課次卡", 但保持擴充可能.
- First-Expire-First-Use 如果有多張相同的卡片
- 體驗卡與約課次卡順序, 體驗卡優先.

預約與上課
- 每次預約扣一張約課次卡.
- 老師維護每週重複的可授課時段（支持例外）。
- 學生查看老師空檔並預約, 30分鐘一個課時 (上課時間25分鐘, 5分鐘休息)。
- 會議連結 MVP：由老師提供（可填 Zoom 個人會議室或每次填寫）。
- 通知：預約成功、課前 24h/1h 提醒、課後提醒（老師與學生各自需填資料）。
- 自動審批：預約成功即 confirmed（衝突或超容量才擋）。
- 管理員可以幫學生約課(由管理約約課仍然會扣課卡)

課後閉環
- 老師：24H內上傳截圖證明 + 填對課堂評價(提示老師可以作業/詞彙/語法/發音/連貫性/表現)才能進結算, 否則顯示待結算。
- 課後學生可以針對老師評價, 一堂課僅能留一次, default僅留言學生用戶可見, admin或老師批准後該留言添加在該老師的頁面.

取消/補課
- 學生取消: 取消政策24小時前取消無消耗, 上课前12~24小時取消课程，消耗1張取消約課卡；上课前2~12小時取消课程，消耗2張取消約課卡；2小時內無法取消預設扣堂。
- 老師取消：退還學生約課次卡, 先記錄，顯示在report中。
- 技術問提：系統紀錄, 由管理員決定補償方案, 例如補償: 約課次卡2張.
- 管理員取消: 不須使用取消約課次卡

結算與報表
- 老師分潤預設5美金一個課時, admin可覆寫修改個別老師設定.
- Admin 報表：預約數、完成率、取消率、技術取消比例 (可見所有老師)。
- Teacher 報表：預約數、完成率、取消率、技術取消比例、估算收入 (僅可見自己)。
- Student：剩餘堂數、已預約與歷史課程。

個人資料管理 (Profile Management)
所有用戶都可以管理個人資料，包含：

基本資料 (所有用戶)
- 頭像：可上傳圖片到 MinIO，使用固定命名格式 (avatar-{userId}.jpg)，支援圖片裁切和縮放至 500x500
- 姓名：用戶顯示名稱
- Email：登入帳號 (不可修改)
- 電話：聯絡電話
- 個人簡介 (Bio)：自我介紹文字
- 密碼修改：傳統三欄位驗證 (原密碼 + 新密碼 + 確認新密碼)

教師額外資料 (Teacher Profile)
教師除了基本資料外，還可設定以下資料，這些資料會同時顯示在：
1. 教師個人資料頁面 (私人管理)
2. 教師公開資料頁面 (學生可見)

- 教師自我介紹：詳細的教學理念和經驗描述
- 證書資訊：教學相關證書和資格
- 教學經驗：從何年開始教學 (experience_since)，系統自動計算年資
- 語言能力：可教授的語言列表
- 教師相簿 (Gallery)：可上傳多媒體檔案
  - 圖片：教學環境、證書照片等
  - 音檔：發音示範、教學片段等
  - 影片：自我介紹影片、教學示範等

檔案管理規範
- 頭像檔案：avatar-{userId}.jpg (固定命名)
- 相簿檔案：gallery-{userId}-{timestamp}.{ext}
- 檔案大小限制：頭像 1MB，相簿檔案 10MB
- 支援格式：圖片 (jpg, png)，音檔 (mp3, wav)，影片 (mp4, webm)

資料庫調整需求
- teacher_profiles 表需要新增 experience_since 欄位 (YEAR 類型)
- 移除或保留 experience_years 欄位 (由 experience_since 計算得出)
- 新增 teacher_gallery 表管理多媒體檔案

管理員用戶管理功能 (Admin User Management)
管理員具有完整的用戶管理權限，包含：

用戶列表與搜尋
- 查看所有用戶列表 (教師/學生/管理員)
- 按角色、狀態、註冊時間等條件篩選
- 搜尋功能：按姓名、Email 搜尋用戶
- 分頁顯示，支援排序

新增用戶
- 新增教師：包含基本資料 + 教師檔案設定
- 新增學生：包含基本資料
- 新增管理員：僅限超級管理員
- 自動生成預設密碼或允許設定初始密碼

修改用戶資料
- 修改所有用戶的基本資料 (姓名、電話、個人簡介等)
- 修改教師完整檔案：
  - 教學經驗、證書、語言能力
  - 教學領域、地區、價格設定
  - 上傳/管理教師相簿 (圖片/音檔/影片)
- 啟用/停用用戶帳號
- 修改用戶角色 (謹慎操作)

密碼管理
- 重置任何用戶密碼
- 強制用戶下次登入時修改密碼
- 查看密碼最後修改時間

教師檔案管理
- 管理教師相簿：上傳、刪除、重新排序
- 審核教師上傳的內容
- 設定教師公開/私人狀態
- 管理教師可用時間設定

批量操作
- 批量啟用/停用用戶
- 批量發送通知
- 批量重置密碼
- 匯出用戶資料

權限與隱私
- RBAC：Admin/Teacher/Student 路由與資料可見性隔離。
- 檔案：課堂截圖上傳至 S3/MinIO，私有存取，僅 Admin 或對應老師可見, 老師profile的圖片與影片也可以上傳到此處。
- 個人資料：用戶只能修改自己的資料，Admin 可修改所有用戶資料。
- 教師公開資料：學生可查看教師的公開資料，但不能修改。
- 管理員操作日誌：記錄所有管理員對用戶資料的修改操作。