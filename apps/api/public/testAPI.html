<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ•™å¹³å° API å®Œæ•´æ¸¬è©¦å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 80vh;
        }

        .sidebar {
            width: 300px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 20px;
        }

        .content {
            flex: 1;
            padding: 20px;
        }

        .test-suite {
            margin-bottom: 30px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
        }

        .test-suite-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .test-suite-header h3 {
            color: #495057;
            margin: 0;
        }

        .test-suite-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: #ffc107;
            color: #212529;
        }

        .status-running {
            background: #17a2b8;
            color: white;
        }

        .status-success {
            background: #28a745;
            color: white;
        }

        .status-error {
            background: #dc3545;
            color: white;
        }

        .test-suite-body {
            padding: 20px;
            display: none;
        }

        .test-suite-body.active {
            display: block;
        }

        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #fff;
        }

        .test-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .test-item h4 {
            color: #495057;
            margin: 0;
        }

        .test-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
        }

        .input-group {
            margin: 10px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .response-container {
            margin-top: 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            overflow: hidden;
        }

        .response-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .response-body {
            padding: 15px;
            background: #f8f9fa;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .auth-panel {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .auth-panel h4 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .token-display {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
        }

        .collapsible {
            cursor: pointer;
            user-select: none;
        }

        .collapsible:hover {
            background: #e9ecef;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .hidden {
            display: none;
        }

        /* æ–°å¢ï¼šè«‹æ±‚åƒæ•¸é¡¯ç¤º */
        .request-params {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .request-params-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }

        /* æ–°å¢ï¼šcurl æŒ‡ä»¤å€åŸŸ */
        .curl-container {
            margin-top: 10px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            overflow: hidden;
        }

        .curl-header {
            background: #2d2d2d;
            color: white;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .curl-body {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
        }

        .btn-copy-curl {
            background: #007bff;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .btn-copy-curl:hover {
            background: #0056b3;
        }

        .btn-copy-curl.copied {
            background: #28a745;
        }

        /* æ–°å¢ï¼šæ—¥èªŒå€åŸŸ */
        .log-section {
            margin-top: 30px;
            border-top: 2px solid #dee2e6;
            padding-top: 20px;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .log-header h3 {
            color: #495057;
            margin: 0;
        }

        .log-controls {
            display: flex;
            gap: 10px;
        }

        .log-container {
            background: #1e1e1e;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
            padding: 15px;
        }

        .log-entry {
            margin-bottom: 15px;
            padding: 12px;
            background: #2d2d2d;
            border-left: 4px solid #007bff;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #d4d4d4;
        }

        .log-entry.success {
            border-left-color: #28a745;
        }

        .log-entry.error {
            border-left-color: #dc3545;
        }

        .log-time {
            color: #6c757d;
            font-size: 11px;
            margin-bottom: 5px;
        }

        .log-request {
            color: #61dafb;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .log-status {
            margin-bottom: 5px;
        }

        .log-status.success {
            color: #28a745;
        }

        .log-status.error {
            color: #dc3545;
        }

        .log-response {
            color: #98c379;
            margin-top: 5px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .log-empty {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            font-style: italic;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ“ å®¶æ•™å¹³å° API å®Œæ•´æ¸¬è©¦å·¥å…·</h1>
        <p>è‡ªå‹•åŒ–æ¸¬è©¦æ‰€æœ‰ API ç«¯é»ï¼Œé©—è­‰åŠŸèƒ½å’Œæ¬Šé™</p>
    </div>

    <div class="main-content">
        <div class="sidebar">
            <div class="auth-panel">
                <h4>ğŸ” èªè­‰ç®¡ç†</h4>
                <div class="input-group">
                    <label>è§’è‰²</label>
                    <select id="userRole">
                        <option value="admin">ç®¡ç†å“¡</option>
                        <option value="teacher">æ•™å¸«</option>
                        <option value="student">å­¸ç”Ÿ</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>é›»å­éƒµä»¶</label>
                    <input type="email" id="loginEmail" value="admin@example.com">
                </div>
                <div class="input-group">
                    <label>å¯†ç¢¼</label>
                    <input type="password" id="loginPassword" value="password">
                </div>
                <button class="btn btn-primary" onclick="login()">ç™»å…¥</button>
                <button class="btn btn-secondary" onclick="logout()">ç™»å‡º</button>
                <div id="tokenDisplay" class="token-display hidden"></div>
            </div>

            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">ç¸½æ¸¬è©¦</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="passedTests">0</div>
                    <div class="stat-label">é€šé</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">å¤±æ•—</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <button class="btn btn-success" onclick="runAllTests()" style="width: 100%; margin-bottom: 10px;">
                ğŸš€ åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
            </button>

            <button class="btn btn-danger" onclick="resetTests()" style="width: 100%; margin-bottom: 10px;">
                ğŸ”„ é‡ç½®æ¸¬è©¦
            </button>

            <button class="btn btn-warning" onclick="clearTestData()" style="width: 100%;">
                ğŸ—‘ï¸ æ¸…é™¤æ¸¬è©¦è³‡æ–™
            </button>
        </div>

        <div class="content" id="testContent">
            <!-- æ¸¬è©¦å…§å®¹å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>

    <!-- æ–°å¢ï¼šæ—¥èªŒå€åŸŸ -->
    <div class="log-section" style="padding: 20px;">
        <div class="log-header">
            <h3>ğŸ“‹ è«‹æ±‚æ—¥èªŒ</h3>
            <div class="log-controls">
                <button class="btn btn-info" onclick="copyLogs()">ğŸ“„ è¤‡è£½æ—¥èªŒ</button>
                <button class="btn btn-secondary" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…é™¤æ—¥èªŒ</button>
            </div>
        </div>
        <div class="log-container" id="logContainer">
            <div class="log-empty">å°šç„¡è«‹æ±‚è¨˜éŒ„</div>
        </div>
    </div>
</div>

<script>
    // å…¨åŸŸè®Šæ•¸
    let accessToken = '';
    let currentUser = null;
    let testResults = {
        total: 0,
        passed: 0,
        failed: 0,
        running: false
    };
    let requestLogs = []; // æ–°å¢ï¼šå„²å­˜æ‰€æœ‰è«‹æ±‚æ—¥èªŒ

    const API_BASE = window.location.origin;

    // æ¸¬è©¦é…ç½®
    const testSuites = [
        {
            id: 'auth',
            name: 'ğŸ” èªè­‰ç³»çµ±',
            description: 'æ¸¬è©¦ç™»å…¥ã€ç™»å‡ºã€æ¬Šæ–ç®¡ç†',
            tests: [
                {
                    id: 'auth_login',
                    name: 'ç”¨æˆ¶ç™»å…¥',
                    method: 'POST',
                    endpoint: '/auth/login',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['accessToken', 'refreshToken', 'user'],
                    data: () => ({
                        username: document.getElementById('loginEmail').value,
                        password: document.getElementById('loginPassword').value
                    })
                },
                {
                    id: 'auth_me',
                    name: 'å–å¾—å€‹äººè³‡è¨Š',
                    method: 'GET',
                    endpoint: '/auth/me',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['id', 'role', 'name']
                },
                {
                    id: 'auth_me_unauthorized',
                    name: 'æœªæˆæ¬Šè¨ªå•',
                    method: 'GET',
                    endpoint: '/auth/me',
                    requireAuth: false,
                    expectedStatus: 401,
                    expectedFields: ['statusCode']
                },
                {
                    id: 'auth_refresh',
                    name: 'åˆ·æ–°æ¬Šæ–',
                    method: 'POST',
                    endpoint: '/auth/refresh',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['accessToken', 'refreshToken'],
                    data: () => ({
                        refreshToken: 'invalid_token'
                    }),
                    shouldFail: true,
                    expectedStatus: 401
                },
                {
                    id: 'auth_logout',
                    name: 'ç”¨æˆ¶ç™»å‡º',
                    method: 'POST',
                    endpoint: '/auth/logout',
                    requireAuth: true,
                    expectedStatus: 204
                }
            ]
        },
        {
            id: 'users',
            name: 'ğŸ‘¥ ç”¨æˆ¶ç®¡ç†',
            description: 'æ¸¬è©¦ç”¨æˆ¶è³‡è¨ŠæŸ¥è©¢å’Œæ›´æ–°',
            tests: [
                {
                    id: 'users_get',
                    name: 'å–å¾—ç”¨æˆ¶è³‡è¨Š',
                    method: 'GET',
                    endpoint: '/users/11111111-1111-1111-1111-111111111111',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['id', 'role', 'name']
                },
                {
                    id: 'users_update',
                    name: 'æ›´æ–°å€‹äººè³‡æ–™',
                    method: 'PATCH',
                    endpoint: () => `/users/${currentUser?.id}`,
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['id', 'name'],
                    data: () => ({
                        name: 'æ¸¬è©¦æ›´æ–°åç¨±'
                    })
                }
            ]
        },
        {
            id: 'teachers',
            name: 'ğŸ‘¨â€ğŸ« æ•™å¸«ç®¡ç†',
            description: 'æ¸¬è©¦æ•™å¸«æ¸…å–®å’Œè©³ç´°è³‡è¨Š',
            tests: [
                {
                    id: 'teachers_list',
                    name: 'æ•™å¸«æ¸…å–®',
                    method: 'GET',
                    endpoint: '/teachers',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['items', 'total']
                },
                {
                    id: 'teachers_detail',
                    name: 'æ•™å¸«è©³ç´°è³‡è¨Š',
                    method: 'GET',
                    endpoint: '/teachers/22222222-2222-2222-2222-222222222222',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['id', 'name', 'intro']
                },
                {
                    id: 'teachers_search',
                    name: 'æ•™å¸«æœå°‹',
                    method: 'GET',
                    endpoint: '/teachers?q=English',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['items']
                }
            ]
        },
        {
            id: 'teacher-availability',
            name: 'ğŸ•’ æ•™å¸«å¯ç”¨æ™‚é–“',
            description: 'æ¸¬è©¦æ•™å¸«å¯ç”¨æ™‚é–“ç®¡ç†åŠŸèƒ½',
            tests: [
                {
                    id: 'search_teachers',
                    name: 'æœå°‹å¯ç”¨æ•™å¸«',
                    method: 'GET',
                    endpoint: '/teacher-availability/search-teachers?date=2025-10-01&fromTime=18:00&toTime=23:30',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['code', 'msg', 'data']
                },
                {
                    id: 'teacher_timetable',
                    name: 'æ•™å¸«æ™‚é–“è¡¨',
                    method: 'GET',
                    endpoint: '/teacher-availability/teacher-timetable?teacherId=22222222-2222-2222-2222-222222222222&date=2025-10-01',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['code', 'msg', 'data']
                },
                {
                    id: 'all_time_slots',
                    name: 'æ‰€æœ‰æ™‚é–“æ§½',
                    method: 'GET',
                    endpoint: '/teacher-availability/time-slots',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['code', 'msg', 'data']
                }
            ]
        },
        {
            id: 'bookings',
            name: 'ğŸ“… é ç´„ç®¡ç†',
            description: 'æ¸¬è©¦é ç´„ç›¸é—œåŠŸèƒ½',
            tests: [
                {
                    id: 'bookings_list',
                    name: 'é ç´„æ¸…å–®',
                    method: 'GET',
                    endpoint: '/bookings',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['items']
                },
                {
                    id: 'bookings_create',
                    name: 'å»ºç«‹é ç´„',
                    method: 'POST',
                    endpoint: '/bookings',
                    requireAuth: true,
                    expectedStatus: 201,
                    data: () => {
                        // å»ºç«‹ä¸€å€‹å°é½Šåˆ°30åˆ†é˜æ™‚é–“æ§½çš„æ™‚é–“
                        const tomorrow = new Date(Date.now() + 24 * 60 * 60 * 1000);
                        tomorrow.setHours(10, 0, 0, 0); // è¨­å®šç‚ºæ˜å¤©ä¸Šåˆ10:00
                        return {
                            teacherId: '22222222-2222-2222-2222-222222222222',
                            startsAt: tomorrow.toISOString(),
                            durationMinutes: 30,
                            courseTitle: 'æ¸¬è©¦èª²ç¨‹'
                        };
                    }
                }
            ]
        },
        {
            id: 'purchases',
            name: 'ğŸ’³ è³¼è²·é …ç›®',
            description: 'æ¸¬è©¦è³¼è²·é …ç›®ç®¡ç†',
            tests: [
                {
                    id: 'purchases_list',
                    name: 'å–å¾—è³¼è²·é …ç›®åˆ—è¡¨',
                    method: 'GET',
                    endpoint: '/purchases',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['items'],
                    roles: ['student']
                },
                {
                    id: 'purchases_activate',
                    name: 'å•Ÿå‹•å¡ç‰‡',
                    method: 'POST',
                    endpoint: '/purchases/test-purchase-id/activate',
                    requireAuth: true,
                    expectedStatus: 200,
                    roles: ['student']
                }
            ]
        },
        {
            id: 'favorites',
            name: 'â­ æ”¶è—ç³»çµ±',
            description: 'æ¸¬è©¦æ•™å¸«æ”¶è—åŠŸèƒ½ - æ‰€æœ‰è§’è‰²éƒ½å¯ä½¿ç”¨',
            tests: [
                {
                    id: 'favorites_list',
                    name: 'å–å¾—æ”¶è—åˆ—è¡¨',
                    method: 'GET',
                    endpoint: '/favorites',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['items'],
                    roles: ['student', 'teacher', 'admin']
                },
                {
                    id: 'favorites_add',
                    name: 'æ–°å¢æ”¶è—',
                    method: 'POST',
                    endpoint: '/favorites',
                    requireAuth: true,
                    expectedStatus: 201,
                    expectedFields: ['teacherId', 'addedAt'],
                    roles: ['student', 'teacher', 'admin'],
                    data: () => ({
                        teacherId: 'ae73d133-6d96-4640-a4d8-aefb8f43d4d2'
                    })
                },
                {
                    id: 'favorites_add_duplicate',
                    name: 'é‡è¤‡æ”¶è—ï¼ˆæ‡‰å¤±æ•—ï¼‰',
                    method: 'POST',
                    endpoint: '/favorites',
                    requireAuth: true,
                    expectedStatus: 409,
                    roles: ['student', 'teacher', 'admin'],
                    shouldFail: true,
                    data: () => ({
                        teacherId: 'ae73d133-6d96-4640-a4d8-aefb8f43d4d2'
                    })
                },
                {
                    id: 'favorites_add_invalid_teacher',
                    name: 'æ”¶è—ä¸å­˜åœ¨çš„æ•™å¸«ï¼ˆæ‡‰å¤±æ•—ï¼‰',
                    method: 'POST',
                    endpoint: '/favorites',
                    requireAuth: true,
                    expectedStatus: 404,
                    roles: ['student'],
                    shouldFail: true,
                    data: () => ({
                        teacherId: '99999999-9999-9999-9999-999999999999'
                    })
                },
                {
                    id: 'favorites_remove',
                    name: 'ç§»é™¤æ”¶è—',
                    method: 'DELETE',
                    endpoint: '/favorites/ae73d133-6d96-4640-a4d8-aefb8f43d4d2',
                    requireAuth: true,
                    expectedStatus: 204,
                    roles: ['student', 'teacher', 'admin']
                },
                {
                    id: 'favorites_remove_not_found',
                    name: 'ç§»é™¤ä¸å­˜åœ¨çš„æ”¶è—ï¼ˆæ‡‰å¤±æ•—ï¼‰',
                    method: 'DELETE',
                    endpoint: '/favorites/99999999-9999-9999-9999-999999999999',
                    requireAuth: true,
                    expectedStatus: 404,
                    roles: ['student'],
                    shouldFail: true
                }
            ]
        },

        {
            id: 'materials',
            name: 'ğŸ“„ æ•™æç®¡ç†',
            description: 'æ¸¬è©¦æ•™æCRUDåŠŸèƒ½èˆ‡è³‡æ–™å¤¾æ¨¹',
            tests: [
                {
                    id: 'materials_list',
                    name: 'å–å¾—æ•™æåˆ—è¡¨',
                    method: 'GET',
                    endpoint: '/materials',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['items', 'total']
                },
                {
                    id: 'materials_tree',
                    name: 'å–å¾—è³‡æ–™å¤¾æ¨¹',
                    method: 'GET',
                    endpoint: '/materials?include=all',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['folders']
                },
                {
                    id: 'materials_flat',
                    name: 'å–å¾—æ‰å¹³æ•™æåˆ—è¡¨',
                    method: 'GET',
                    endpoint: '/materials?include=flat',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['materials']
                },
                {
                    id: 'materials_search',
                    name: 'æœå°‹æ•™æ',
                    method: 'GET',
                    endpoint: '/materials?q=English&type=page',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['items']
                },
                {
                    id: 'materials_create',
                    name: 'å»ºç«‹æ•™æ',
                    method: 'POST',
                    endpoint: '/materials',
                    requireAuth: true,
                    expectedStatus: 201,
                    expectedFields: ['id', 'title'],
                    roles: ['admin', 'teacher'],
                    data: () => ({
                        type: 'page',
                        title: 'æ¸¬è©¦æ•™æ',
                        content: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦æ•™æå…§å®¹',
                        folderId: null
                    })
                }
            ]
        },
        {
            id: 'notifications',
            name: 'ğŸ”” é€šçŸ¥ç³»çµ±',
            description: 'æ¸¬è©¦é€šçŸ¥åŠŸèƒ½',
            tests: [
                {
                    id: 'notifications_list',
                    name: 'å–å¾—é€šçŸ¥åˆ—è¡¨',
                    method: 'GET',
                    endpoint: '/notifications',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['items'],
                    roles: ['student', 'teacher', 'admin']
                },
                {
                    id: 'notifications_unread',
                    name: 'å–å¾—æœªè®€é€šçŸ¥',
                    method: 'GET',
                    endpoint: '/notifications?unreadOnly=true',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['items'],
                    roles: ['student', 'teacher', 'admin']
                }
            ]
        },
        {
            id: 'reviews',
            name: 'â­ è©•åƒ¹ç³»çµ±',
            description: 'æ¸¬è©¦è©•åƒ¹åŠŸèƒ½',
            tests: [
                {
                    id: 'reviews_list',
                    name: 'å–å¾—è©•åƒ¹åˆ—è¡¨',
                    method: 'GET',
                    endpoint: '/reviews',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['items']
                },
                {
                    id: 'reviews_by_teacher',
                    name: 'å–å¾—æ•™å¸«è©•åƒ¹',
                    method: 'GET',
                    endpoint: '/reviews?teacherId=ae73d133-6d96-4640-a4d8-aefb8f43d4d2',
                    requireAuth: false,
                    expectedStatus: 200,
                    expectedFields: ['items']
                }
            ]
        },
        {
            id: 'admin',
            name: 'âš™ï¸ ç®¡ç†å“¡åŠŸèƒ½',
            description: 'æ¸¬è©¦ç®¡ç†å“¡å°ˆç”¨åŠŸèƒ½',
            tests: [
                {
                    id: 'admin_reports',
                    name: 'æŸ¥çœ‹å ±è¡¨',
                    method: 'GET',
                    endpoint: '/admin/reports',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['totalBookings'],
                    roles: ['admin']
                },
                {
                    id: 'admin_create_teacher',
                    name: 'å»ºç«‹æ•™å¸«',
                    method: 'POST',
                    endpoint: '/admin/teachers',
                    requireAuth: true,
                    expectedStatus: 201,
                    expectedFields: ['id', 'email'],
                    roles: ['admin'],
                    data: () => ({
                        name: 'æ¸¬è©¦æ•™å¸«',
                        email: `test-teacher-${Date.now()}@example.com`,
                        password: 'teacher123',
                        intro: 'é€™æ˜¯ä¸€ä½æ¸¬è©¦æ•™å¸«',
                        experienceYears: 3,
                        domains: ['English'],
                        regions: ['Taiwan'],
                        certifications: ['TESOL'],
                        pricePolicies: []
                    })
                },
                {
                    id: 'admin_create_student',
                    name: 'å»ºç«‹å­¸ç”Ÿ',
                    method: 'POST',
                    endpoint: '/admin/students',
                    requireAuth: true,
                    expectedStatus: 201,
                    expectedFields: ['id', 'email'],
                    roles: ['admin'],
                    data: () => ({
                        name: 'æ¸¬è©¦å­¸ç”Ÿ',
                        email: `test-student-${Date.now()}@example.com`,
                        password: 'student123',
                        initialTimezone: 'Asia/Taipei'
                    })
                },
                {
                    id: 'admin_grant_cards',
                    name: 'æˆäºˆå­¸ç”Ÿå¡ç‰‡',
                    method: 'POST',
                    endpoint: '/admin/grant-cards',
                    requireAuth: true,
                    expectedStatus: 201,
                    roles: ['admin'],
                    data: () => ({
                        studentId: '33333333-3333-3333-3333-333333333333',
                        packageName: 'æ¸¬è©¦å¡ç‰‡',
                        quantity: 5,
                        type: 'lesson_card',
                        notes: 'è‡ªå‹•æ¸¬è©¦æˆäºˆ'
                    })
                },
                {
                    id: 'admin_update_user_profile',
                    name: 'ç®¡ç†å“¡æ›´æ–°ç”¨æˆ¶è³‡æ–™',
                    method: 'PATCH',
                    endpoint: '/users/33333333-3333-3333-3333-333333333333',
                    requireAuth: true,
                    expectedStatus: 200,
                    expectedFields: ['id', 'name'],
                    roles: ['admin'],
                    data: () => ({
                        name: 'ç®¡ç†å“¡æ›´æ–°çš„åç¨±',
                        bio: 'ç®¡ç†å“¡æ›´æ–°çš„ç°¡ä»‹'
                    })
                },
                {
                    id: 'non_admin_update_other_profile',
                    name: 'éç®¡ç†å“¡æ›´æ–°ä»–äººè³‡æ–™ï¼ˆæ‡‰å¤±æ•—ï¼‰',
                    method: 'PATCH',
                    endpoint: '/users/33333333-3333-3333-3333-333333333333',
                    requireAuth: true,
                    expectedStatus: 403,
                    roles: ['teacher', 'student'],
                    shouldFail: true,
                    data: () => ({
                        name: 'å˜—è©¦æ›´æ–°ä»–äººåç¨±'
                    })
                },
                {
                    id: 'admin_forbidden',
                    name: 'éç®¡ç†å“¡è¨ªå•ï¼ˆæ‡‰å¤±æ•—ï¼‰',
                    method: 'GET',
                    endpoint: '/admin/reports',
                    requireAuth: true,
                    expectedStatus: 403,
                    roles: ['teacher', 'student'],
                    shouldFail: true
                }
            ]
        }
    ];

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        initializeTestSuites();
        updateRoleCredentials();

        // è§’è‰²åˆ‡æ›äº‹ä»¶
        document.getElementById('userRole').addEventListener('change', updateRoleCredentials);
    });

    // æ›´æ–°è§’è‰²å°æ‡‰çš„ç™»å…¥è³‡è¨Š
    function updateRoleCredentials() {
        const role = document.getElementById('userRole').value;
        const emailInput = document.getElementById('loginEmail');

        const credentials = {
            admin: 'admin@example.com',
            teacher: 'teacher1@example.com',
            student: 'student1@example.com'
        };

        emailInput.value = credentials[role];
    }

    // åˆå§‹åŒ–æ¸¬è©¦å¥—ä»¶
    function initializeTestSuites() {
        const content = document.getElementById('testContent');
        content.innerHTML = '';

        testSuites.forEach(suite => {
            const suiteElement = createTestSuiteElement(suite);
            content.appendChild(suiteElement);
        });

        updateStats();
    }

    // å»ºç«‹æ¸¬è©¦å¥—ä»¶å…ƒç´ 
    function createTestSuiteElement(suite) {
        const suiteDiv = document.createElement('div');
        suiteDiv.className = 'test-suite';
        suiteDiv.id = `suite-${suite.id}`;

        suiteDiv.innerHTML = `
                <div class="test-suite-header collapsible" onclick="toggleSuite('${suite.id}')">
                    <div>
                        <h3>${suite.name}</h3>
                        <p style="margin: 5px 0 0 0; color: #6c757d; font-size: 0.9em;">${suite.description}</p>
                    </div>
                    <div class="test-suite-status">
                        <span class="status-badge status-pending" id="status-${suite.id}">å¾…æ¸¬è©¦</span>
                        <span id="progress-${suite.id}">0/${suite.tests.length}</span>
                    </div>
                </div>
                <div class="test-suite-body" id="body-${suite.id}">
                    ${suite.tests.map(test => createTestItemHTML(test, suite.id)).join('')}
                    <div class="test-controls">
                        <button class="btn btn-primary" onclick="runSuiteTests('${suite.id}')">
                            åŸ·è¡Œæ­¤å¥—ä»¶æ¸¬è©¦
                        </button>
                    </div>
                </div>
            `;

        return suiteDiv;
    }

    // å»ºç«‹æ¸¬è©¦é …ç›® HTML
    function createTestItemHTML(test, suiteId) {
        const roleInfo = test.roles ? `<small>é™åˆ¶è§’è‰²: ${test.roles.join(', ')}</small>` : '';
        const shouldFailInfo = test.shouldFail ? '<small style="color: #dc3545;">é æœŸå¤±æ•—</small>' : '';

        return `
                <div class="test-item" id="test-${test.id}">
                    <div class="test-item-header">
                        <div>
                            <h4>${test.name}</h4>
                            <small>${test.method} ${typeof test.endpoint === 'function' ? 'å‹•æ…‹ç«¯é»' : test.endpoint}</small>
                            ${roleInfo}
                            ${shouldFailInfo}
                        </div>
                        <span class="status-badge status-pending" id="status-${test.id}">å¾…æ¸¬è©¦</span>
                    </div>
                    <div class="test-controls">
                        <button class="btn btn-primary" onclick="runSingleTest('${test.id}', '${suiteId}')">
                            åŸ·è¡Œæ¸¬è©¦
                        </button>
                    </div>
                    <div class="request-params" id="params-${test.id}" style="display: none;">
                        <div class="request-params-title">ğŸ“¤ å‚³é€åƒæ•¸</div>
                        <div id="params-content-${test.id}"></div>
                    </div>
                    <div class="curl-container" id="curl-${test.id}" style="display: none;">
                        <div class="curl-header">
                            <span>ğŸ“‹ cURL æŒ‡ä»¤</span>
                            <button class="btn-copy-curl" onclick="copyCurlCommand('${test.id}')">è¤‡è£½</button>
                        </div>
                        <div class="curl-body" id="curl-body-${test.id}"></div>
                    </div>
                    <div class="response-container hidden" id="response-${test.id}">
                        <div class="response-header">
                            <span>å›æ‡‰çµæœ</span>
                            <span id="response-status-${test.id}"></span>
                        </div>
                        <div class="response-body" id="response-body-${test.id}"></div>
                    </div>
                </div>
            `;
    }

    // ç”Ÿæˆ cURL æŒ‡ä»¤
    function generateCurlCommand(test, endpoint, requestData) {
        let curl = `curl -X ${test.method} '${API_BASE}${endpoint}'`;

        if (test.requireAuth && accessToken) {
            curl += ` \\\n  -H 'Authorization: Bearer ${accessToken}'`;
        }

        curl += ` \\\n  -H 'Content-Type: application/json'`;

        if (requestData && (test.method === 'POST' || test.method === 'PATCH' || test.method === 'PUT')) {
            curl += ` \\\n  -d '${JSON.stringify(requestData)}'`;
        }

        return curl;
    }

    // è¤‡è£½ cURL æŒ‡ä»¤
    function copyCurlCommand(testId) {
        const curlBody = document.getElementById(`curl-body-${testId}`);
        const copyBtn = event.target;

        navigator.clipboard.writeText(curlBody.textContent).then(() => {
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'å·²è¤‡è£½!';
            copyBtn.classList.add('copied');

            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.classList.remove('copied');
            }, 2000);
        }).catch(err => {
            alert('è¤‡è£½å¤±æ•—ï¼š' + err.message);
        });
    }

    // æ–°å¢ï¼šè¨˜éŒ„è«‹æ±‚æ—¥èªŒ
    function addLog(method, endpoint, status, responseData) {
        const timestamp = new Date().toLocaleString('zh-TW', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });

        const log = {
            timestamp,
            method,
            endpoint,
            status,
            responseData,
            isSuccess: status >= 200 && status < 300
        };

        requestLogs.push(log);
        updateLogDisplay();
    }

    // æ–°å¢ï¼šæ›´æ–°æ—¥èªŒé¡¯ç¤º
    function updateLogDisplay() {
        const logContainer = document.getElementById('logContainer');

        if (requestLogs.length === 0) {
            logContainer.innerHTML = '<div class="log-empty">å°šç„¡è«‹æ±‚è¨˜éŒ„</div>';
            return;
        }

        logContainer.innerHTML = requestLogs.map(log => {
            const statusClass = log.isSuccess ? 'success' : 'error';
            const responsePreview = log.responseData
                ? JSON.stringify(log.responseData, null, 2).substring(0, 200) + (JSON.stringify(log.responseData).length > 200 ? '...' : '')
                : 'No response';

            return `
                    <div class="log-entry ${statusClass}">
                        <div class="log-time">${log.timestamp}</div>
                        <div class="log-request">${log.method} ${log.endpoint}</div>
                        <div class="log-status ${statusClass}">Status: ${log.status} ${log.isSuccess ? 'âœ“' : 'âœ—'}</div>
                        <div class="log-response">Response: ${responsePreview}</div>
                    </div>
                `;
        }).reverse().join('');

        // è‡ªå‹•æ»¾å‹•åˆ°æœ€æ–°çš„æ—¥èªŒ
        logContainer.scrollTop = 0;
    }

    // æ–°å¢ï¼šè¤‡è£½æ‰€æœ‰æ—¥èªŒ
    function copyLogs() {
        if (requestLogs.length === 0) {
            alert('ç›®å‰æ²’æœ‰æ—¥èªŒå¯è¤‡è£½');
            return;
        }

        const logsText = requestLogs.map(log => {
            return `[${log.timestamp}] ${log.method} ${log.endpoint}
Status: ${log.status}
Response: ${JSON.stringify(log.responseData, null, 2)}
${'='.repeat(80)}`;
        }).join('\n\n');

        navigator.clipboard.writeText(logsText).then(() => {
            alert('æ—¥èªŒå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }).catch(err => {
            alert('è¤‡è£½å¤±æ•—ï¼š' + err.message);
        });
    }

    // æ–°å¢ï¼šæ¸…é™¤æ‰€æœ‰æ—¥èªŒ
    function clearLogs() {
        if (requestLogs.length === 0) {
            alert('ç›®å‰æ²’æœ‰æ—¥èªŒ');
            return;
        }

        if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ—¥èªŒå—ï¼Ÿ')) {
            requestLogs = [];
            updateLogDisplay();
        }
    }

    // åˆ‡æ›æ¸¬è©¦å¥—ä»¶é¡¯ç¤º
    function toggleSuite(suiteId) {
        const body = document.getElementById(`body-${suiteId}`);
        body.classList.toggle('active');
    }

    // HTTP è«‹æ±‚å‡½æ•¸ï¼ˆä¿®æ”¹ä»¥è¨˜éŒ„æ—¥èªŒï¼‰
    async function makeRequest(endpoint, options = {}) {
        const url = `${API_BASE}${endpoint}`;
        const headers = {
            'Content-Type': 'application/json',
            ...options.headers
        };

        if (options.requireAuth && accessToken) {
            headers['Authorization'] = `Bearer ${accessToken}`;
        }

        try {
            const response = await fetch(url, {
                ...options,
                headers
            });

            let data;
            try {
                data = await response.json();
            } catch (e) {
                data = null;
            }

            // è¨˜éŒ„æ—¥èªŒ
            addLog(options.method || 'GET', endpoint, response.status, data);

            return {
                status: response.status,
                ok: response.ok,
                data,
                headers: response.headers
            };
        } catch (error) {
            // è¨˜éŒ„éŒ¯èª¤æ—¥èªŒ
            addLog(options.method || 'GET', endpoint, 0, { error: error.message });

            return {
                status: 0,
                ok: false,
                data: { error: error.message },
                headers: null
            };
        }
    }

    // ç™»å…¥å‡½æ•¸
    async function login() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        const response = await makeRequest('/auth/login', {
            method: 'POST',
            body: JSON.stringify({
                username: email,
                password: password
            })
        });

        if (response.ok && response.data.accessToken) {
            accessToken = response.data.accessToken;
            currentUser = response.data.user;

            document.getElementById('tokenDisplay').innerHTML =
                `<strong>å·²ç™»å…¥:</strong> ${currentUser.name} (${currentUser.role})<br>
                     <strong>Token:</strong> ${accessToken.substring(0, 50)}...`;
            document.getElementById('tokenDisplay').classList.remove('hidden');

            alert(`ç™»å…¥æˆåŠŸï¼æ­¡è¿ ${currentUser.name}`);
        } else {
            alert('ç™»å…¥å¤±æ•—ï¼š' + (response.data?.message || 'æœªçŸ¥éŒ¯èª¤'));
        }
    }

    // ç™»å‡ºå‡½æ•¸
    async function logout() {
        if (accessToken) {
            await makeRequest('/auth/logout', {
                method: 'POST',
                requireAuth: true
            });
        }

        accessToken = '';
        currentUser = null;
        document.getElementById('tokenDisplay').classList.add('hidden');
        alert('å·²ç™»å‡º');
    }

    // æ¸…é™¤æ¸¬è©¦è³‡æ–™
    async function clearTestData() {
        if (!accessToken) {
            alert('è«‹å…ˆç™»å…¥ï¼ˆéœ€è¦ç®¡ç†å“¡æ¬Šé™ï¼‰');
            return;
        }

        if (!currentUser || currentUser.role !== 'admin') {
            alert('æ­¤åŠŸèƒ½éœ€è¦ç®¡ç†å“¡æ¬Šé™');
            return;
        }

        if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ¸¬è©¦è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œå°‡é‡ç½®ç³»çµ±è³‡æ–™ã€‚')) {
            return;
        }

        try {
            const response = await makeRequest('/admin/reset-data', {
                method: 'POST',
                requireAuth: true
            });

            if (response.ok) {
                alert('æ¸¬è©¦è³‡æ–™å·²æ¸…é™¤æˆåŠŸï¼');
            } else {
                alert('æ¸…é™¤æ¸¬è©¦è³‡æ–™å¤±æ•—ï¼š' + (response.data?.message || `HTTP ${response.status}`));
            }
        } catch (error) {
            alert('æ¸…é™¤æ¸¬è©¦è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
        }
    }

    // åŸ·è¡Œå–®ä¸€æ¸¬è©¦
    async function runSingleTest(testId, suiteId) {
        const suite = testSuites.find(s => s.id === suiteId);
        const test = suite.tests.find(t => t.id === testId);

        if (!test) return;

        // æª¢æŸ¥è§’è‰²æ¬Šé™
        if (test.roles && currentUser && !test.roles.includes(currentUser.role)) {
            updateTestStatus(testId, 'error', 'è§’è‰²æ¬Šé™ä¸ç¬¦');
            return;
        }

        updateTestStatus(testId, 'running', 'åŸ·è¡Œä¸­...');

        try {
            // æº–å‚™è«‹æ±‚åƒæ•¸
            const endpoint = typeof test.endpoint === 'function' ? test.endpoint() : test.endpoint;
            const requestOptions = {
                method: test.method,
                requireAuth: test.requireAuth
            };

            let requestData = null;
            if (test.data && (test.method === 'POST' || test.method === 'PATCH' || test.method === 'PUT')) {
                requestData = test.data();
                requestOptions.body = JSON.stringify(requestData);
            }

            // é¡¯ç¤ºå‚³é€åƒæ•¸
            displayRequestParams(testId, test, endpoint, requestData);

            // ç”Ÿæˆä¸¦é¡¯ç¤º cURL æŒ‡ä»¤
            const curlCommand = generateCurlCommand(test, endpoint, requestData);
            displayCurlCommand(testId, curlCommand);

            // ç™¼é€è«‹æ±‚
            const response = await makeRequest(endpoint, requestOptions);

            // é¡¯ç¤ºå›æ‡‰
            displayResponse(testId, response);

            // é©—è­‰çµæœ
            const isValid = validateResponse(test, response);

            if (isValid) {
                updateTestStatus(testId, 'success', 'é€šé');
                testResults.passed++;
            } else {
                updateTestStatus(testId, 'error', 'å¤±æ•—');
                testResults.failed++;
            }

        } catch (error) {
            updateTestStatus(testId, 'error', 'éŒ¯èª¤: ' + error.message);
            testResults.failed++;
        }

        updateStats();
        updateSuiteProgress(suiteId);
    }

    // é¡¯ç¤ºå‚³é€åƒæ•¸
    function displayRequestParams(testId, test, endpoint, requestData) {
        const paramsContainer = document.getElementById(`params-${testId}`);
        const paramsContent = document.getElementById(`params-content-${testId}`);

        let paramsHTML = `<strong>æ–¹æ³•:</strong> ${test.method}<br>`;
        paramsHTML += `<strong>ç«¯é»:</strong> ${endpoint}<br>`;

        if (test.requireAuth) {
            paramsHTML += `<strong>èªè­‰:</strong> Bearer Token<br>`;
        }

        if (requestData) {
            paramsHTML += `<strong>è«‹æ±‚é«”:</strong><br><pre>${JSON.stringify(requestData, null, 2)}</pre>`;
        }

        paramsContent.innerHTML = paramsHTML;
        paramsContainer.style.display = 'block';
    }

    // é¡¯ç¤º cURL æŒ‡ä»¤
    function displayCurlCommand(testId, curlCommand) {
        const curlContainer = document.getElementById(`curl-${testId}`);
        const curlBody = document.getElementById(`curl-body-${testId}`);

        curlBody.textContent = curlCommand;
        curlContainer.style.display = 'block';
    }

    // é©—è­‰å›æ‡‰
    function validateResponse(test, response) {
        // æª¢æŸ¥ç‹€æ…‹ç¢¼
        if (response.status !== test.expectedStatus) {
            return false;
        }

        // å¦‚æœé æœŸå¤±æ•—ä¸”ç¢ºå¯¦å¤±æ•—ï¼Œå‰‡é€šé
        if (test.shouldFail && !response.ok) {
            return true;
        }

        // æª¢æŸ¥å¿…è¦æ¬„ä½
        if (test.expectedFields && response.data) {
            for (const field of test.expectedFields) {
                if (!(field in response.data)) {
                    return false;
                }
            }
        }

        return true;
    }

    // æ›´æ–°æ¸¬è©¦ç‹€æ…‹
    function updateTestStatus(testId, status, message) {
        const statusElement = document.getElementById(`status-${testId}`);
        statusElement.className = `status-badge status-${status}`;
        statusElement.textContent = message;
    }

    // é¡¯ç¤ºå›æ‡‰çµæœ
    function displayResponse(testId, response) {
        const container = document.getElementById(`response-${testId}`);
        const statusElement = document.getElementById(`response-status-${testId}`);
        const bodyElement = document.getElementById(`response-body-${testId}`);

        container.classList.remove('hidden');
        statusElement.textContent = `HTTP ${response.status}`;
        statusElement.className = response.ok ? 'status-badge status-success' : 'status-badge status-error';

        bodyElement.textContent = JSON.stringify(response.data, null, 2);
    }

    // åŸ·è¡Œå¥—ä»¶æ¸¬è©¦
    async function runSuiteTests(suiteId) {
        const suite = testSuites.find(s => s.id === suiteId);
        if (!suite) return;

        updateSuiteStatus(suiteId, 'running');

        for (const test of suite.tests) {
            await runSingleTest(test.id, suiteId);
            await new Promise(resolve => setTimeout(resolve, 500)); // å»¶é²é¿å…éå¿«è«‹æ±‚
        }

        updateSuiteStatus(suiteId, 'success');
    }

    // æ›´æ–°å¥—ä»¶ç‹€æ…‹
    function updateSuiteStatus(suiteId, status) {
        const statusElement = document.getElementById(`status-${suiteId}`);
        const statusText = {
            pending: 'å¾…æ¸¬è©¦',
            running: 'åŸ·è¡Œä¸­',
            success: 'å®Œæˆ',
            error: 'æœ‰éŒ¯èª¤'
        };

        statusElement.className = `status-badge status-${status}`;
        statusElement.textContent = statusText[status];
    }

    // æ›´æ–°å¥—ä»¶é€²åº¦ï¼ˆæ–°å¢å¤±æ•—å€‹æ•¸çµ±è¨ˆï¼‰
    function updateSuiteProgress(suiteId) {
        const suite = testSuites.find(s => s.id === suiteId);
        if (!suite) return;

        let completed = 0;
        let failed = 0;

        suite.tests.forEach(test => {
            const statusElement = document.getElementById(`status-${test.id}`);
            if (statusElement) {
                const statusText = statusElement.textContent;
                if (!statusText.includes('å¾…æ¸¬è©¦') && !statusText.includes('åŸ·è¡Œä¸­')) {
                    completed++;
                    if (statusText.includes('å¤±æ•—') || statusText.includes('éŒ¯èª¤') || statusText.includes('æ¬Šé™ä¸ç¬¦')) {
                        failed++;
                    }
                }
            }
        });

        const progressText = failed > 0
            ? `${completed}/${suite.tests.length} (å¤±æ•—: ${failed})`
            : `${completed}/${suite.tests.length}`;

        document.getElementById(`progress-${suiteId}`).textContent = progressText;
    }

    // åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
    async function runAllTests() {
        if (testResults.running) return;

        testResults.running = true;
        testResults.total = testSuites.reduce((sum, suite) => sum + suite.tests.length, 0);
        testResults.passed = 0;
        testResults.failed = 0;

        for (const suite of testSuites) {
            await runSuiteTests(suite.id);
        }

        testResults.running = false;
        alert(`æ¸¬è©¦å®Œæˆï¼é€šé: ${testResults.passed}, å¤±æ•—: ${testResults.failed}`);
    }

    // é‡ç½®æ¸¬è©¦
    function resetTests() {
        testResults = { total: 0, passed: 0, failed: 0, running: false };
        initializeTestSuites();
    }

    // æ›´æ–°çµ±è¨ˆ
    function updateStats() {
        document.getElementById('totalTests').textContent = testResults.total;
        document.getElementById('passedTests').textContent = testResults.passed;
        document.getElementById('failedTests').textContent = testResults.failed;

        const progress = testResults.total > 0 ? ((testResults.passed + testResults.failed) / testResults.total) * 100 : 0;
        document.getElementById('progressFill').style.width = `${progress}%`;
    }
</script>
</body>
</html>